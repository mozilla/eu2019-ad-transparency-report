#!/bin/bash

set -o errexit -o pipefail -o nounset

cd "$(dirname "$0")/.."

HEADERS=$(cat <<EOF
{ \
    "Content-Security-Policy": "default-src 'self' d3js.org; font-src fonts.googleapis.com; style-src use.fontawesome.com; frame-ancestors 'none'", \
    "Strict-Transport-Security": "max-age=63072000", \
    "X-Content-Type-Options": "nosniff" \
}
EOF
)

SYNC_OPTIONS=(
    --delete
    --cache-control "max-age=300"
    --metadata "$HEADERS"
    --metadata-directive "REPLACE"
    --acl "public-read"
)

aws s3 sync \
    "${SYNC_OPTIONS[@]}" \
    www/ "s3://${DEPLOY_BUCKET}/"
